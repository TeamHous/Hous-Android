name: Android CI

on:
  pull_request:
    branches: [ develop, main ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    
    - name: Gradle cache
      uses: actions/cache@v2
      with:
        path: |
          ~/.gradle/caches
          ~/.gradle/wrapper
        key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*') }}
        restore-keys: |
          ${{ runner.os }}-gradle-
        
    - name: set up JDK 11
      uses: actions/setup-java@v3
      with:
        java-version: '11'
        distribution: 'temurin'
        cache: gradle
        
    - name: Touch local properties
      run: touch local.properties
      
    - name: Access HOUS_URL
      env:
          HOUS_URL: ${{ secrets.HOUS_URL }}
      run: echo "HOUS_URL=\"$HOUS_URL\"" >> local.properties

    - name: Access DUMMY_ACCESS_TOKEN
      env:
          DUMMY_ACCESS_TOKEN: ${{ secrets.DUMMY_ACCESS_TOKEN }}
      run: echo "DUMMY_ACCESS_TOKEN=\"$DUMMY_ACCESS_TOKEN\"" >> local.properties

    - name: Grant execute permission for gradlew
      run: chmod +x gradlew
      
    - name: Build with Gradle
      run: ./gradlew build
      
    - name: On Success!! Congratulations
      if: ${{ success() }}
      uses: rtCamp/action-slack-notify@v2
      env:
        SLACK_COLOR: '#53A551'
        SLACK_ICON: https://user-images.githubusercontent.com/82709044/177440664-14f7184b-b1f4-4c2c-ab6a-d7974cdafff9.png
        SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK_URL }}
        SLACK_TITLE: 'Hous/PR Check S.U.C.C.E.S.S ğŸ‰ğŸ‰ğŸ‰'
        MSG_MINIMAL: true
        SLACK_USERNAME: HELFOOME-AOS
        SLACK_MESSAGE: 'PRì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!!! ğŸ‰ğŸ‰ğŸ‰'

    - name: On Failed, Notify in Slack
      if: ${{ failure() }}
      uses: rtCamp/action-slack-notify@v2
      env:
        SLACK_COLOR: '#ff0000'
        
        SLACK_ICON: https://user-images.githubusercontent.com/82709044/177440664-14f7184b-b1f4-4c2c-ab6a-d7974cdafff9.png
        SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK_URL }}
        SLACK_TITLE: 'Hous/Android Debug build FailâŒ'
        MSG_MINIMAL: true
        SLACK_USERNAME: HELFOOME-AOS
        SLACK_MESSAGE: 'ì—ëŸ¬ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”'
